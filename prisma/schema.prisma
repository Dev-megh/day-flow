datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  EMPLOYEE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  LEAVE
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LeaveType {
  PAID
  SICK
  UNPAID
}

model User {
  id          Int          @id @default(autoincrement())
  employeeId  String       @unique
  name        String
  email       String       @unique
  password    String
  role        Role
  attendances Attendance[]
  leaves      Leave[]
  payroll     Payroll?
  address     String
  phone       String
  approvedLeaves  Leave[]         @relation("LeaveApprover")
  leaveComments   LeaveComment[]  @relation("LeaveComments")
}

model Attendance {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime
  checkIn   DateTime?
  checkOut  DateTime?
  status    AttendanceStatus

  @@unique([userId, date])
}

model Leave {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  leaveType       String   // CASUAL, SICK, EARNED, UNPAID
  startDate       DateTime
  endDate         DateTime
  totalDays       Float
  isHalfDay       Boolean  @default(false)
  reason          String
  
  status          String   @default("PENDING") // PENDING, APPROVED, REJECTED
  approverComment String?
  approverId      Int?
  approver        User?    @relation("LeaveApprover", fields: [approverId], references: [id])
  approvedAt      DateTime?
  
  comments        LeaveComment[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model LeaveComment {
  id        Int      @id @default(autoincrement())
  leaveId   Int
  leave     Leave    @relation(fields: [leaveId], references: [id], onDelete: Cascade)
  
  userId    Int
  user      User     @relation("LeaveComments", fields: [userId], references: [id])
  
  text      String
  createdAt DateTime @default(now())
}

model Payroll {
  id      Int     @id @default(autoincrement())
  userId  Int     @unique
  user    User    @relation(fields: [userId], references: [id])
  salary  Int
}